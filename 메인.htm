<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" type="text/css" href="assets/css/import.css">
    <script src="assets/js/jquery-1.9.1.min.js"></script>
    <script src="assets/js/common.js"></script>
    <title>메인</title>
</head>
<body>
    <div class="wrap">
        <!-- 상단 -->
        <header class="header">
            <div class="header_body">
                <div class="logo">
                    <h1><a href="#"><img src="assets/img/logo.png" alt="요기요" /></a></h1>
                    <p>제휴사 프로모션 지원 페이지</p>
                </div>
                <div class="top_right">
                    <div class="gnb">
                        <ul>
                            <li><a href="#">프로모션 등록</a></li>
                            <li><a href="#">프로모션 리스트</a></li>
                            <li><a href="#">제휴사 정보 수정</a></li>
                        </ul>
                    </div>
                    <button type="button" class="btn_logout">로그아웃</button>
                </div>
            </div>
        </header>
        <!--// 상단 -->

        <!-- 컨테이너 -->
        <div class="container">
            <!-- 메인 상단 정보 -->
            <div class="main_top">
                <div class="item tp_all">
                    <h2>전체</h2>
                    <div class="count">25<em>건</em></div>
                </div>

                <div class="item tp_ing">
                    <h2>진행중</h2>
                    <div class="count">25<em>건</em></div>
                </div>

                <div class="item tp_turn">
                    <h2>반려</h2>
                    <div class="count">25<em>건</em></div>
                </div>

                <div class="item tp_end">
                    <h2>종료</h2>
                    <div class="count">25<em>건</em></div>
                </div>
            </div>
            <!--// 메인 상단 정보 -->

            <!-- 컨텐츠 -->
            <div class="contents">
                <div class="main_card_group" id="main_card_group">
                    
                    <!-- <div class="main_card">
                        <div class="main_card_body">
                            <h2 class="tit">뜨레쥬르</h2>
                            <p class="date">2022.05.15 ~ 2022.05.30</p>
                            <ul>
                                <li>프로모션 설정 : <em>기간</em></li>
                                <li>프로모션 구문 : <em>배달</em></li>
                                <li>프로모션 형태 : <em>메뉴할인</em></li>
                                <li>할인금액 설정 : 본사 <span class="price">5,000</span> 원 / 가맹점 <span class="price">5,000</span> 원</li>
                            </ul>
                        </div>
                        <div class="circle_bar">
                            <strong><span>D-7</span></strong>
                        </div>
                        <button type="button" class="btn_modify">수정하기</button>
                    </div>

                    <div class="main_card">
                        <div class="main_card_body">
                            <h2 class="tit">뜨레쥬르</h2>
                            <p class="date">2022.05.15 ~ 2022.05.30</p>
                            <ul>
                                <li>프로모션 설정 : <em>기간</em></li>
                                <li>프로모션 구문 : <em>배달</em></li>
                                <li>프로모션 형태 : <em>메뉴할인</em></li>
                                <li>할인금액 설정 : 본사 <span class="price">5,000</span> 원 / 가맹점 <span class="price">5,000</span> 원</li>
                            </ul>
                        </div>
                        <div class="circle_bar">
                            <strong><span>D-7</span></strong>
                        </div>
                        <button type="button" class="btn_modify">수정하기</button>
                    </div>

                    <div class="main_card">
                        <div class="main_card_body">
                            <h2 class="tit">뜨레쥬르</h2>
                            <p class="date">2022.05.15 ~ 2022.05.30</p>
                            <ul>
                                <li>프로모션 설정 : <em>기간</em></li>
                                <li>프로모션 구문 : <em>배달</em></li>
                                <li>프로모션 형태 : <em>메뉴할인</em></li>
                                <li>할인금액 설정 : 본사 <span class="price">5,000</span> 원 / 가맹점 <span class="price">5,000</span> 원</li>
                            </ul>
                        </div>
                        <div class="circle_bar">
                            <strong><span>D-7</span></strong>
                        </div>
                        <button type="button" class="btn_modify">수정하기</button>
                    </div>

                    <div class="main_card">
                        <div class="main_card_body">
                            <h2 class="tit">뜨레쥬르</h2>
                            <p class="date">2022.05.15 ~ 2022.05.30</p>
                            <ul>
                                <li>프로모션 설정 : <em>기간</em></li>
                                <li>프로모션 구문 : <em>배달</em></li>
                                <li>프로모션 형태 : <em>메뉴할인</em></li>
                                <li>할인금액 설정 : 본사 <span class="price">5,000</span> 원 / 가맹점 <span class="price">5,000</span> 원</li>
                            </ul>
                        </div>
                        <div class="circle_bar">
                            <strong><span>D-7</span></strong>
                        </div>
                        <button type="button" class="btn_modify">수정하기</button>
                    </div>

                    <div class="main_card">
                        <div class="main_card_body">
                            <h2 class="tit">뜨레쥬르</h2>
                            <p class="date">2022.05.15 ~ 2022.05.30</p>
                            <ul>
                                <li>프로모션 설정 : <em>기간</em></li>
                                <li>프로모션 구문 : <em>배달</em></li>
                                <li>프로모션 형태 : <em>메뉴할인</em></li>
                                <li>할인금액 설정 : 본사 <span class="price">5,000</span> 원 / 가맹점 <span class="price">5,000</span> 원</li>
                            </ul>
                        </div>
                        <div class="circle_bar">
                            <strong><span>D-7</span></strong>
                        </div>
                        <button type="button" class="btn_modify">수정하기</button>
                    </div>

                    <div class="main_card">
                        <div class="main_card_body">
                            <h2 class="tit">뜨레쥬르</h2>
                            <p class="date">2022.05.15 ~ 2022.05.30</p>
                            <ul>
                                <li>프로모션 설정 : <em>기간</em></li>
                                <li>프로모션 구문 : <em>배달</em></li>
                                <li>프로모션 형태 : <em>메뉴할인</em></li>
                                <li>할인금액 설정 : 본사 <span class="price">5,000</span> 원 / 가맹점 <span class="price">5,000</span> 원</li>
                            </ul>
                        </div>
                        <div class="circle_bar">
                            <strong><span>D-7</span></strong>
                        </div>
                        <button type="button" class="btn_modify">수정하기</button>
                    </div> -->

                </div>
            </div>
            <!--// 컨텐츠 -->
        </div>
        <!--// 컨테이너 -->

    </div>

    <script type="text/javascript" src="assets/js/circle-progress.js"></script>
    <script>
        $(function() {
            var data = [
                {
                    brandName : "뜨레쥬르",
                    regDate : '2022.05.15', // 등록일
                    promoStart : '2022.05.15', // 프로모션 시작일
                    promoEnd : '2022.05.20', // 프로모션 종료일
                    promoSet : '기간',
                    promoKind : '메뉴할인',
                    promoForm : '배달',
                    priceHeadOffice : 10000,
                    promoStore : 1000,
                    promoHurdle : 1000,
                },
                {
                    brandName : "파리바게뜨",
                    regDate : '2022.05.15', // 등록일
                    promoStart : '2022.06.15', // 프로모션 시작일
                    promoEnd : '2022.07.30', // 프로모션 종료일
                    promoSet : '요일',
                    promoKind : '전 메뉴',
                    promoForm : '방문포장',
                    priceHeadOffice : 5000,
                    promoStore : 3000,
                    promoHurdle : 2000,
                },
                {
                    brandName : "뜨레쥬르",
                    regDate : '2022.05.15', // 등록일
                    promoStart : '2022.05.15', // 프로모션 시작일
                    promoEnd : '2022.05.30', // 프로모션 종료일
                    promoSet : '기간',
                    promoKind : '메뉴할인',
                    promoForm : '배달',
                    priceHeadOffice : 10000,
                    promoStore : 1000,
                    promoHurdle : 1000,
                },
                {
                    brandName : "파리바게뜨",
                    regDate : '2022.05.15', // 등록일
                    promoStart : '2022.06.15', // 프로모션 시작일
                    promoEnd : '2022.07.30', // 프로모션 종료일
                    promoSet : '요일',
                    promoKind : '전 메뉴',
                    promoForm : '방문포장',
                    priceHeadOffice : 5000,
                    promoStore : 3000,
                    promoHurdle : 2000,
                },
                {
                    brandName : "족발먹을래",
                    regDate : '2022.05.15', // 등록일
                    promoStart : '2022.05.15', // 프로모션 시작일
                    promoEnd : '2022.06.30', // 프로모션 종료일
                    promoSet : '기간',
                    promoKind : '메뉴할인',
                    promoForm : '방문포장',
                    priceHeadOffice : 5000,
                    promoStore : 3000,
                    promoHurdle : 2000,
                }
        ]
        var promoStart = 20;
        var promoEnd = 20;
        var barColor = ["#66f66f", "#73dcff", "#ff5668"];
        var barValue = []; // 바그래프의 값이 들어갑니다. 0~1 사이
        var statusTxt = "";
        data.forEach(function(element, index, array){
            var today = new Date();
            var regDay = new Date(array[index].regDate); // 등록일
            var startDay = new Date(array[index].promoStart); // 프로모션 시작일
            var endDay = new Date(array[index].promoEnd); // 프로모션 종료일
            var gap = endDay - today;
            var progap = endDay - startDay;
            var ddayCount = Math.floor(gap / (1000 * 60 * 60 * 24));
            var tt = Math.floor(progap / (1000 * 60 * 60 * 24));
            
            if(today < startDay){
                ddayCount = "오픈전";
                barValue.push(0);
            }else{
                if(ddayCount <= 0){
                    ddayCount = "종료";
                    barValue.push(0);
                }else{
                    
                    ddayCount = 'D-' + Math.floor(gap / (1000 * 60 * 60 * 24));
                    barValue.push(Math.floor(gap / (1000 * 60 * 60 * 24))/tt);
                    console.debug(Math.floor(gap / (1000 * 60 * 60 * 24))/tt);
                }
            }
            
            var html = '';
                html += '<div class="main_card">';
                html += '<div class="main_card_body">';
                html += '<h2 class="tit">뜨레쥬르</h2>';
                html += '<p class="date">' + array[index].promoStart + ' ~ ' + array[index].promoEnd + '</p>';
                html += '<ul>';
                html += '<li>프로모션 설정 : <em>' + array[index].promoSet + '</em></li>';
                html += '<li>프로모션 구문 : <em>' + array[index].promoKind + '</em></li>';
                html += '<li>프로모션 형태 : <em>' + array[index].promoForm + '</em></li>';
                html += '<li>할인금액 설정 : 본사 <span class="price">' + array[index].priceHeadOffice + '</span> 원 / 가맹점 <span class="price">' + array[index].promoStore + '</span> 원</li>';
                html += '</ul>';
                html += '</div>';
                html += '<div class="circle_bar">';
                html += '<strong><span>' + ddayCount + '</span></strong>';
                html += '</div>';
                html += '<button type="button" class="btn_modify">수정하기</button>';
                html += '</div>';
            $("#main_card_group").append(html);
        });
        $.each($('.circle_bar'), function(i,v){
            if(barValue[i] < 0.2){
                barColor = "#ff5668";
            }else if(barValue[i] > 0.4){
                barColor = "#73dcff";
            }else if(barValue[i] > 0.75){
                barColor = "#66f66f";
            }
            $(v).circleProgress({
                size:120,
                startAngle: -Math.PI / 4 * 2,
                value: 1,
                lineCap: 'round',
                thickness: 18,
                fill: {color: barColor}
            })
            setTimeout(function() { 
                $(v).circleProgress('value', barValue[i]); 
            }, 1000);
        });

        

        });
    </script>

</body>
</html>